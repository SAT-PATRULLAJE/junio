<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SAT ‚Äì Sistema de An√°lisis Territorial</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<style>
  :root { --sat-muted:#6c757d; --sat-brand:#0d6efd; }
  body { font-size: 0.9rem; background:#f8f9fa; }
  .map-container { height: 440px; margin-bottom:16px; }
  .brand { font-weight:700; }
  .subtle { color: var(--sat-muted); }
  footer { font-size:0.8rem; text-align:center; margin:24px 0 8px; color:#666; }
  .btn-whatsapp { background:#25d366; color:white; font-weight:bold; }
  .badge-kpi { font-weight:600; font-size:.9rem; }
  .row-gap { row-gap: .75rem; }
  .table-sm td, .table-sm th { vertical-align: top; }
  .btn-toggle { min-width: 135px; }

  .leaflet-control.filter-chip {
    background: rgba(255,255,255,.92);
    border: 1px solid #dee2e6;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,.08);
    padding: 6px 10px;
    font-size: .85rem;
    max-width: 360px;
    line-height: 1.2;
  }
  .leaflet-control.filter-chip b { color: #0d6efd; }
</style>
</head>
<body class="container py-3">

  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
    <h4 class="m-0 brand">SAT ‚Äì Sistema de An√°lisis Territorial <sup>¬©</sup></h4>
    <div class="text-end">
      <div class="small">CENTRO DE OPERACIONES</div>
      <div class="small">Corte: <span class="subtle">29/08/2025 05:31</span></div>
      <div class="small">
        Periodo (ALERTAS):
        <span class="subtle">
          01/06/2025 ‚Äì 30/06/2025
        </span>
        ¬∑ Eventos: <span class="subtle">115</span>
      </div>
    </div>
  </div>

  <div class="d-flex flex-wrap gap-2 mb-3">
    <span class="badge bg-primary badge-kpi">Alertas: <span id="kpiAlertas">18</span></span>
    <span class="badge bg-secondary badge-kpi">Eventos: <span id="kpiEventos">80</span></span>
    <span id="kpiDia" class="badge bg-info text-dark badge-kpi d-none">
      D√≠a: <span id="kpiDiaVal"></span>
    </span>
  </div>

  <!-- FILTROS -->
  <div class="row row-gap mb-2">
    <div class="col-6 col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" id="fDesde" class="form-control form-control-sm">
    </div>
    <div class="col-6 col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" id="fHasta" class="form-control form-control-sm">
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">Distrito</label>
      <select id="fComis" class="form-select form-select-sm"><option value="">(todos)</option></select>
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">Franja</label>
      <select id="fFranja" class="form-select form-select-sm">
        <option value="">(todas)</option>
        <option>Madrugada</option>
        <option>Ma√±ana</option>
        <option>Tarde</option>
        <option>Noche</option>
      </select>
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">D√≠a</label>
      <select id="fDia" class="form-select form-select-sm">
        <option value="">(todos)</option>
        <option>Lunes</option>
        <option>Martes</option>
        <option>Mi√©rcoles</option>
        <option>Jueves</option>
        <option>Viernes</option>
        <option>S√°bado</option>
        <option>Domingo</option>
      </select>
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">Eventos (ventana)</label>
      <select id="fVentana" class="form-select form-select-sm">
        <option value="">(usar rango)</option>
        <option value="1">24 hs</option>
        <option value="2">48 hs</option>
        <option value="3">72 hs</option>
        <option value="7">7 d√≠as</option>
        <option value="15">15 d√≠as</option>
      </select>
    </div>
  </div>

  <!-- MAPA -->
  <div id="map" class="map-container border rounded"></div>

  <!-- TOGGLES -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <button class="btn btn-sm btn-outline-secondary btn-toggle" id="btnBase">üó∫Ô∏è OSM</button>
    <button class="btn btn-sm btn-outline-secondary btn-toggle" id="btnHybrid">üõ∞Ô∏è Sat√©lite + Calles</button>
    <button class="btn btn-sm btn-outline-primary btn-toggle" id="btnHeat">üî• Heatmap ON/OFF</button>
    <button class="btn btn-sm btn-outline-dark btn-toggle" id="btnPolys">‚¨õ Pol√≠gonos ON/OFF</button>
    <button class="btn btn-sm btn-outline-primary btn-toggle" id="btnCircles">üîµ C√≠rculos ON/OFF</button>
    <button class="btn btn-sm btn-outline-danger btn-toggle" id="btnDelitos">üî¥ Eventos Estudio ON/OFF</button>
  </div>

  <div class="d-flex align-items-center gap-2 mb-3">
    <label for="sPt" class="form-label m-0">Tama√±o puntos/heat</label>
    <input type="range" id="sPt" class="form-range" min="2" max="18" step="1" value="4" style="width:220px">
    <span id="sPtVal" class="small text-muted">4</span>
  </div>

  <!-- TABLA -->
  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Distrito</th><th>Comisar√≠a</th><th>Zona</th><th>Franja</th>
          <th>Rango</th><th>Radio (m)</th><th>Eventos</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <footer>
    ¬© SAT ‚Äì Sistema de An√°lisis Territorial | Lic. Sebasti√°n Gonz√°lez
  </footer>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/wellknown@0.5.0/wellknown.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
  // ===== Datos inyectados desde Apps Script =====
  window.SAT = window.SAT || {};
  SAT.DATA    = [{"Alerta_ID":"ALR_450m_22/06/2025_-32.93156_-68.86119_4 // Zona Doctor Salvador Civit 1405","Fecha":"2025-06-22T03:00:00.000Z","D√≠a":"Domingo (75%)","Franja":"üåÜ Noche (75%)","Rango_horario_total":"18:30‚Äì22:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":4,"Comisaria":"Comisaria 40","Distrito":"Villa Marini","Zona_centroide":"Doctor Salvador Civit 1405","Calles_triangulacion":"Paul Grousac 895 / General Miguel Soler 501","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.93328,-68.86006/-32.93328,-68.86006/-32.92984,-68.86232/-32.92984,-68.86232","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86232 -32.92984, -68.86006 -32.93328, -68.86232 -32.92984))","Centroide_lat":-32.931560000000005,"Centroide_lng":-68.86119000000001,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_25/06/2025_-32.90434_-68.86087_5 // Zona Penna 2123","Fecha":"2025-06-25T03:00:00.000Z","D√≠a":"Lunes (40%)","Franja":"üåô Madrugada (60%)","Rango_horario_total":"22:30‚Äì02:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":5,"Comisaria":"Comisaria 27","Distrito":"Villa Hipodromo","Zona_centroide":"Penna 2123","Calles_triangulacion":"Paraguay 1521 / Renato Della Santa 2164 / Necochea 2130 / Renato Della Santa 2164 / Penna 2051","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.90451,-68.86144/-32.90403,-68.86246/-32.90405,-68.85693/-32.90403,-68.86246/-32.90507,-68.86105","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86246 -32.90403, -68.86105 -32.90507, -68.85693 -32.90405, -68.86246 -32.90403))","Centroide_lat":-32.904337999999996,"Centroide_lng":-68.86086800000001,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_16/06/2025_-32.93552_-68.83847_3 // Zona Ricardo Rojas 870","Fecha":"2025-06-16T03:00:00.000Z","D√≠a":"Lunes (33%)","Franja":"üåô Madrugada (33%)","Rango_horario_total":"06:30‚Äì18:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 27","Distrito":"Villa Hipodromo","Zona_centroide":"Ricardo Rojas 870","Calles_triangulacion":"Benavente J. 681 / Juan Gualberto Godoy 648 / Cervantes 760","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.93554,-68.8371/-32.93564,-68.83802/-32.93539,-68.84028","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.84028 -32.93539, -68.83802 -32.93564, -68.8371 -32.93554, -68.84028 -32.93539))","Centroide_lat":-32.935523333333336,"Centroide_lng":-68.83846666666666,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_20/06/2025_-32.90322_-68.88375_9 // Zona Bolivar 3266","Fecha":"2025-06-20T03:00:00.000Z","D√≠a":"Viernes (33%)","Franja":"üåÜ Noche (44%)","Rango_horario_total":"06:30‚Äì18:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":9,"Comisaria":"Comisaria 50","Distrito":"Villa del Parque","Zona_centroide":"Bolivar 3266","Calles_triangulacion":"Lautaro 3436 / Presidente Sarmiento 2089 / Encon 3230 / Presidente Sarmiento 3144 / La Paz 3261 / Presidente Sarmiento 3144 / Chiclana 3102 / La Paz 3276","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.90439,-68.88657/-32.90324,-68.88303/-32.90617,-68.88312/-32.90418,-68.8842/-32.90062,-68.88348/-32.90418,-68.8842/-32.90285,-68.88052/-32.9009,-68.88354","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.88657 -32.90439, -68.88312 -32.90617, -68.88052 -32.90285, -68.88348 -32.90062, -68.88506 -32.90243, -68.88657 -32.90439))","Centroide_lat":-32.90321777777777,"Centroide_lng":-68.88374666666668,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_17/06/2025_-32.92061_-68.87718_6 // Zona Iglesias P. 3150","Fecha":"2025-06-17T03:00:00.000Z","D√≠a":"Lunes (50%)","Franja":"üåÜ Noche (50%)","Rango_horario_total":"00:00‚Äì02:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":6,"Comisaria":"Comisaria 50","Distrito":"Villa del Parque","Zona_centroide":"Iglesias P. 3150","Calles_triangulacion":"Nogoli 613 / Pergamino 619 / Nogoli 613 / Pergamino 669 / Chapanay 3099","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.9215,-68.87571/-32.92202,-68.87744/-32.92152,-68.87568/-32.92136,-68.87783/-32.91863,-68.8782/-32.91863,-68.8782","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.8782 -32.91863, -68.87783 -32.92136, -68.87744 -32.92202, -68.87568 -32.92152, -68.8782 -32.91863))","Centroide_lat":-32.92061,"Centroide_lng":-68.87717666666667,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_02/06/2025_-32.90412_-68.85088_3 // Zona Santiago de Liniers 612","Fecha":"2025-06-02T03:00:00.000Z","D√≠a":"Lunes (67%)","Franja":"üå§Ô∏è Ma√±ana (67%)","Rango_horario_total":"10:30‚Äì22:30","Rango_operativo_SAT":"06:00‚Äì11:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 34","Distrito":"Centro","Zona_centroide":"Santiago de Liniers 612","Calles_triangulacion":"Santiago de Liniers 592 / Del Valle Iberlucea 1940 / Santiago de Liniers 589","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.90415,-68.85027/-32.90432,-68.85073/-32.90389,-68.85165","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.85165 -32.90389, -68.85073 -32.90432, -68.85027 -32.90415, -68.85165 -32.90389))","Centroide_lat":-32.90412,"Centroide_lng":-68.85088333333333,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_24/06/2025_-32.91736_-68.85018_4 // Zona Derqui 271","Fecha":"2025-06-24T03:00:00.000Z","D√≠a":"Mi√©rcoles (25%)","Franja":"üåô Madrugada (50%)","Rango_horario_total":"02:30‚Äì14:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":4,"Comisaria":"Comisaria 34","Distrito":"Villa Hipodromo","Zona_centroide":"Derqui 271","Calles_triangulacion":"Derqui 288 / Derqui 257","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.91761,-68.85045/-32.91734,-68.85007/-32.91734,-68.85007/-32.91714,-68.85015","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.85045 -32.91761, -68.85007 -32.91734, -68.85015 -32.91714, -68.85045 -32.91761))","Centroide_lat":-32.91735750000001,"Centroide_lng":-68.850185,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_17/06/2025_-32.91077_-68.84749_3 // Zona Almirante Brown 1291","Fecha":"2025-06-17T03:00:00.000Z","D√≠a":"Martes (33%)","Franja":"üåÜ Noche (67%)","Rango_horario_total":"14:30‚Äì18:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 34","Distrito":"Centro","Zona_centroide":"Almirante Brown 1291","Calles_triangulacion":"Fidel de Luc√≠a 1194 / Echeverr√≠a 1325 / Echeverr√≠a 1320","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.91204,-68.84607/-32.91019,-68.848/-32.91009,-68.84839","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.84839 -32.91009, -68.84607 -32.91204, -68.848 -32.91019, -68.84839 -32.91009))","Centroide_lat":-32.91077333333333,"Centroide_lng":-68.84748666666667,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_09/06/2025_-32.92386_-68.84306_3 // Zona Antonio Tomba 91","Fecha":"2025-06-09T03:00:00.000Z","D√≠a":"S√°bado (67%)","Franja":"üåÜ Noche (67%)","Rango_horario_total":"02:30‚Äì22:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 7","Distrito":"Centro","Zona_centroide":"Antonio Tomba 91","Calles_triangulacion":"Col√≥n 39 / Mitre 95 / Antonio Tomba 236","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.92509,-68.8452/-32.92435,-68.84105/-32.92215,-68.84294","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.8452 -32.92509, -68.84105 -32.92435, -68.84294 -32.92215, -68.8452 -32.92509))","Centroide_lat":-32.92386333333334,"Centroide_lng":-68.84306333333333,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_24/06/2025_-32.94651_-68.82292_6 // Zona Juan F. Terrada 1452","Fecha":"2025-06-24T03:00:00.000Z","D√≠a":"Domingo (17%)","Franja":"üåÜ Noche (67%)","Rango_horario_total":"06:30‚Äì18:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":6,"Comisaria":"Comisaria 37","Distrito":"Las Tortugas","Zona_centroide":"Juan F. Terrada 1452","Calles_triangulacion":"Azul 1400 / Cerro El Yaucha 1599 / Cabo San Diego 1452 / Chivilcoy 2231 / San Fernando 2445 / Chivilcoy 1996","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.94611,-68.82072/-32.94752,-68.82502/-32.946,-68.82474/-32.94727,-68.82284/-32.94605,-68.81905/-32.94611,-68.82518","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.82518 -32.94611, -68.82502 -32.94752, -68.82284 -32.94727, -68.81905 -32.94605, -68.82474 -32.946, -68.82518 -32.94611))","Centroide_lat":-32.946509999999996,"Centroide_lng":-68.822925,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_25/06/2025_-32.93944_-68.82849_3 // Zona San Crist√≥bal 1537","Fecha":"2025-06-25T03:00:00.000Z","D√≠a":"Lunes (33%)","Franja":"üåÜ Noche (100%)","Rango_horario_total":"22:30‚Äì22:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 37","Distrito":"San Francisco del Monte","Zona_centroide":"San Crist√≥bal 1537","Calles_triangulacion":"San Crist√≥bal 1548 / Los Jazmines 840 / Cerro Trapal 1161","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.93922,-68.8282/-32.93684,-68.83001/-32.94227,-68.82725","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Baja (disperso o baja frecuencia)","Poligono_WKT":"POLYGON((-68.83001 -32.93684, -68.82725 -32.94227, -68.8282 -32.93922, -68.83001 -32.93684))","Centroide_lat":-32.93944333333334,"Centroide_lng":-68.82848666666666,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_09/06/2025_-32.94363_-68.82500_3 // Zona V√©lez Sarsfield 1200","Fecha":"2025-06-09T03:00:00.000Z","D√≠a":"Domingo (33%)","Franja":"üåô Madrugada (67%)","Rango_horario_total":"02:30‚Äì22:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 37","Distrito":"Las Tortugas","Zona_centroide":"V√©lez Sarsfield 1200","Calles_triangulacion":"V√©lez Sarsfield 1175 / V√©lez Sarsfield 1446","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.94288,-68.82469/-32.94288,-68.82469/-32.94513,-68.82562","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.82562 -32.94513, -68.82469 -32.94288, -68.82562 -32.94513))","Centroide_lat":-32.943630000000006,"Centroide_lng":-68.825,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_27/06/2025_-32.94107_-68.83497_3 // Zona Alem 1228","Fecha":"2025-06-27T03:00:00.000Z","D√≠a":"Viernes (67%)","Franja":"üåÜ Noche (100%)","Rango_horario_total":"22:30‚Äì22:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Subc Benegas","Distrito":"Tortugas","Zona_centroide":"Alem 1228","Calles_triangulacion":"Alem 1228","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.94107,-68.83497/-32.94107,-68.83497/-32.94107,-68.83497","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.83497 -32.94107, -68.83497 -32.94107, -68.83497 -32.94107))","Centroide_lat":-32.94107,"Centroide_lng":-68.83497,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_16/06/2025_-32.92927_-68.86778_3 // Zona Ocean√≠a 419","Fecha":"2025-06-16T03:00:00.000Z","D√≠a":"Mi√©rcoles (33%)","Franja":"üåô Madrugada (67%)","Rango_horario_total":"22:30‚Äì02:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 40","Distrito":"Las Tortugas","Zona_centroide":"Ocean√≠a 419","Calles_triangulacion":"Presidente Arturo Illia 358 / Presidente Sarmiento 448 / Ocean√≠a 419","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.92841,-68.86817/-32.92993,-68.86761/-32.92946,-68.86755","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86817 -32.92841, -68.86761 -32.92993, -68.86755 -32.92946, -68.86817 -32.92841))","Centroide_lat":-32.92926666666666,"Centroide_lng":-68.86777666666667,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_12/06/2025_-32.94066_-68.85262_6 // Zona Manuel Garc√≠a 1647","Fecha":"2025-06-12T03:00:00.000Z","D√≠a":"Martes (33%)","Franja":"üåÜ Noche (50%)","Rango_horario_total":"02:30‚Äì22:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":6,"Comisaria":"Comisaria 40","Distrito":"Trapiche","Zona_centroide":"Manuel Garc√≠a 1647","Calles_triangulacion":"Estupi√±an 1665 / Ituzaing√≥ 655 / Larrea 1677 / Payr√≥ 1656 / Estupi√±an 1665","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.94069,-68.85126/-32.93997,-68.85489/-32.94103,-68.85339/-32.94087,-68.85366/-32.94069,-68.85126/-32.94069,-68.85126","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.85489 -32.93997, -68.85366 -32.94087, -68.85339 -32.94103, -68.85126 -32.94069, -68.85489 -32.93997))","Centroide_lat":-32.94065666666666,"Centroide_lng":-68.85262,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_15/06/2025_-32.94225_-68.86113_7 // Zona Vizcaya 1768","Fecha":"2025-06-15T03:00:00.000Z","D√≠a":"Domingo (43%)","Franja":"üåÜ Noche (57%)","Rango_horario_total":"18:30‚Äì06:30","Rango_operativo_SAT":"18:00‚Äì23:59","Radio_m":450,"Cantidad_eventos":7,"Comisaria":"Comisaria 40","Distrito":"Trapiche","Zona_centroide":"Vizcaya 1768","Calles_triangulacion":"Pontevedra 1243 / Los Toneles C2 / Los Naranjos 972 / Santander 1164 / Pontevedra 1165 / Zaragoza 1849 / Lago Palena 1940","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.94119,-68.86179/-32.94279,-68.86293/-32.93958,-68.85913/-32.94375,-68.86138/-32.94142,-68.86055/-32.94283,-68.86241/-32.94421,-68.85975","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86293 -32.94279, -68.86138 -32.94375, -68.85975 -32.94421, -68.85913 -32.93958, -68.86179 -32.94119, -68.86293 -32.94279))","Centroide_lat":-32.94225285714286,"Centroide_lng":-68.86113428571429,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_08/06/2025_-32.94818_-68.85700_6 // Zona Laguna de los P√°jaros 2201","Fecha":"2025-06-08T03:00:00.000Z","D√≠a":"Martes (33%)","Franja":"üåô Madrugada (50%)","Rango_horario_total":"22:30‚Äì22:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":6,"Comisaria":"Comisaria 40","Distrito":"Trapiche","Zona_centroide":"Laguna de los P√°jaros 2201","Calles_triangulacion":"Entre R√≠os 2380 / Entre R√≠os 2364 / Laguna de los P√°jaros 2245 / Rep√∫blica de Siria 880 / Laguna del Toro 1997 / Laguna de Guanacache 1312","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.95018,-68.85506/-32.94984,-68.85493/-32.94866,-68.85723/-32.94627,-68.85583/-32.94558,-68.8579/-32.94858,-68.86103","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86103 -32.94858, -68.85506 -32.95018, -68.85493 -32.94984, -68.85583 -32.94627, -68.8579 -32.94558, -68.86103 -32.94858))","Centroide_lat":-32.948184999999995,"Centroide_lng":-68.85699666666666,"Eventos_puntos":""},{"Alerta_ID":"ALR_450m_19/06/2025_-32.93413_-68.86754_3 // Zona Ing.C. Cipolletti 1831","Fecha":"2025-06-19T03:00:00.000Z","D√≠a":"Martes (33%)","Franja":"üåô Madrugada (33%)","Rango_horario_total":"02:30‚Äì22:30","Rango_operativo_SAT":"00:00‚Äì05:59","Radio_m":450,"Cantidad_eventos":3,"Comisaria":"Comisaria 40","Distrito":"Villa Marini","Zona_centroide":"Ing.C. Cipolletti 1831","Calles_triangulacion":"Presidente Sarmiento 1889 / Asia 1107 / Dique Tulumaya 1984","Link_GMaps_URL":"https://www.google.com/maps/dir/-32.93375,-68.86768/-32.93406,-68.86498/-32.93459,-68.86997","Link_Patrullaje_URL":"","Confiabilidad_leyenda":"Media (patr√≥n moderado / posible dispersi√≥n)","Poligono_WKT":"POLYGON((-68.86997 -32.93459, -68.86498 -32.93406, -68.86768 -32.93375, -68.86997 -32.93459))","Centroide_lat":-32.934133333333335,"Centroide_lng":-68.86754333333333,"Eventos_puntos":""}];
  SAT.DELITOS = [{"lat":-32.93328,"lng":-68.86006,"delito":"Vandalismo","jurisdiccion":"Comisaria 27","fecha":"2025-06-08T17:30:00.000Z"},{"lat":-32.90451,"lng":-68.86144,"delito":"Vandalismo","jurisdiccion":"Comisaria 27","fecha":"2025-06-15T01:30:00.000Z"},{"lat":-32.93564,"lng":-68.83802,"delito":"Pers. en los techos","jurisdiccion":"Comisaria 27","fecha":"2025-06-16T05:30:00.000Z"},{"lat":-32.90418,"lng":-68.8842,"delito":"Intento de robo","jurisdiccion":"Comisaria 27","fecha":"2025-06-16T05:30:00.000Z"},{"lat":-32.92136,"lng":-68.87783,"delito":"Robo de luminarias casa","jurisdiccion":"Comisaria 27","fecha":"2025-06-18T01:30:00.000Z"},{"lat":-32.90403,"lng":-68.86246,"delito":"Intento de robo","jurisdiccion":"Comisaria 27","fecha":"2025-06-23T05:30:00.000Z"},{"lat":-32.90403,"lng":-68.86246,"delito":"Robo de medidor","jurisdiccion":"Comisaria 27","fecha":"2025-06-26T05:30:00.000Z"},{"lat":-32.90507,"lng":-68.86105,"delito":"Pers. en los techos","jurisdiccion":"Comisaria 27","fecha":"2025-06-30T05:30:00.000Z"},{"lat":-32.90432,"lng":-68.85073,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-02T13:30:00.000Z"},{"lat":-32.91761,"lng":-68.85045,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-04T05:30:00.000Z"},{"lat":-32.91904,"lng":-68.85828,"delito":"Robo de neumaticos","jurisdiccion":"Comisaria 34","fecha":"2025-06-05T17:30:00.000Z"},{"lat":-32.91734,"lng":-68.85007,"delito":"Intento de robo","jurisdiccion":"Comisaria 34","fecha":"2025-06-07T05:30:00.000Z"},{"lat":-32.9087,"lng":-68.8592,"delito":"Intento de robo","jurisdiccion":"Comisaria 34","fecha":"2025-06-10T17:30:00.000Z"},{"lat":-32.90389,"lng":-68.85165,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-17T01:30:00.000Z"},{"lat":-32.91019,"lng":-68.848,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-17T21:30:00.000Z"},{"lat":-32.91009,"lng":-68.84839,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-18T21:30:00.000Z"},{"lat":-32.92215,"lng":-68.84294,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-22T01:30:00.000Z"},{"lat":-32.92203,"lng":-68.8511,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-24T01:30:00.000Z"},{"lat":-32.91734,"lng":-68.85007,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-24T21:30:00.000Z"},{"lat":-32.90405,"lng":-68.85693,"delito":"Robo de ruedas","jurisdiccion":"Comisaria 34","fecha":"2025-06-26T01:30:00.000Z"},{"lat":-32.92356,"lng":-68.85715,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-29T21:30:00.000Z"},{"lat":-32.91714,"lng":-68.85015,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 34","fecha":"2025-06-30T17:30:00.000Z"},{"lat":-32.94611,"lng":-68.82072,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 37","fecha":"2025-06-01T09:30:00.000Z"},{"lat":-32.93922,"lng":-68.8282,"delito":"Emergencia","jurisdiccion":"Comisaria 37","fecha":"2025-06-03T01:30:00.000Z"},{"lat":-32.93554,"lng":-68.8371,"delito":"Intento de Robo","jurisdiccion":"Comisaria 37","fecha":"2025-06-04T09:30:00.000Z"},{"lat":-32.94288,"lng":-68.82469,"delito":"Intento de robo","jurisdiccion":"Comisaria 37","fecha":"2025-06-08T05:30:00.000Z"},{"lat":-32.94288,"lng":-68.82469,"delito":"Vandalismo","jurisdiccion":"Comisaria 37","fecha":"2025-06-09T05:30:00.000Z"},{"lat":-32.94107,"lng":-68.83497,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 37","fecha":"2025-06-12T01:30:00.000Z"},{"lat":-32.94443,"lng":-68.82977,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 37","fecha":"2025-06-13T21:30:00.000Z"},{"lat":-32.92946,"lng":-68.86755,"delito":"Intento de robo","jurisdiccion":"Comisaria 37","fecha":"2025-06-18T05:30:00.000Z"},{"lat":-32.94727,"lng":-68.82284,"delito":"Intento de robo","jurisdiccion":"Comisaria 37","fecha":"2025-06-24T21:30:00.000Z"},{"lat":-32.93684,"lng":-68.83001,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 37","fecha":"2025-06-25T21:30:00.000Z"},{"lat":-32.94227,"lng":-68.82725,"delito":"Pers. en los techos","jurisdiccion":"Comisaria 37","fecha":"2025-06-27T01:30:00.000Z"},{"lat":-32.94605,"lng":-68.81905,"delito":"Robo","jurisdiccion":"Comisaria 37","fecha":"2025-06-28T01:30:00.000Z"},{"lat":-32.94611,"lng":-68.82518,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 37","fecha":"2025-06-28T21:30:00.000Z"},{"lat":-32.93328,"lng":-68.86006,"delito":"Ruidos Molestos","jurisdiccion":"Comisaria 40","fecha":"2025-06-01T21:30:00.000Z"},{"lat":-32.94069,"lng":-68.85126,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-03T05:30:00.000Z"},{"lat":-32.94119,"lng":-68.86179,"delito":"Narcomenudeo","jurisdiccion":"Comisaria 40","fecha":"2025-06-06T21:30:00.000Z"},{"lat":-32.94866,"lng":-68.85723,"delito":"Intento de robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-07T05:30:00.000Z"},{"lat":-32.94627,"lng":-68.85583,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-08T05:30:00.000Z"},{"lat":-32.94279,"lng":-68.86293,"delito":"Violencia intrafamiliar","jurisdiccion":"Comisaria 40","fecha":"2025-06-08T21:30:00.000Z"},{"lat":-32.93958,"lng":-68.85913,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-09T01:30:00.000Z"},{"lat":-32.93375,"lng":-68.86768,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-10T05:30:00.000Z"},{"lat":-32.94103,"lng":-68.85339,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-12T21:30:00.000Z"},{"lat":-32.94087,"lng":-68.85366,"delito":"Intento de robo auto","jurisdiccion":"Comisaria 40","fecha":"2025-06-12T21:30:00.000Z"},{"lat":-32.94558,"lng":-68.8579,"delito":"Sensor","jurisdiccion":"Comisaria 40","fecha":"2025-06-13T05:30:00.000Z"},{"lat":-32.92862,"lng":-68.85839,"delito":"Robo medidor de gas","jurisdiccion":"Comisaria 40","fecha":"2025-06-13T05:30:00.000Z"},{"lat":-32.92841,"lng":-68.86817,"delito":"Persona herida","jurisdiccion":"Comisaria 40","fecha":"2025-06-15T01:30:00.000Z"},{"lat":-32.94375,"lng":-68.86138,"delito":"Intento de robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-15T09:30:00.000Z"},{"lat":-32.94902,"lng":-68.86224,"delito":"Intento de robo auto","jurisdiccion":"Comisaria 40","fecha":"2025-06-15T21:30:00.000Z"},{"lat":-32.92993,"lng":-68.86761,"delito":"Disturbios","jurisdiccion":"Comisaria 40","fecha":"2025-06-16T05:30:00.000Z"},{"lat":-32.93406,"lng":-68.86498,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-19T13:30:00.000Z"},{"lat":-32.94142,"lng":-68.86055,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-21T01:30:00.000Z"},{"lat":-32.90946,"lng":-68.88299,"delito":"Vandalismo","jurisdiccion":"Comisaria 40","fecha":"2025-06-21T05:30:00.000Z"},{"lat":-32.94283,"lng":-68.86241,"delito":"Consumo de Alcohol","jurisdiccion":"Comisaria 40","fecha":"2025-06-21T17:30:00.000Z"},{"lat":-32.94134,"lng":-68.87025,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-22T03:00:00.000Z"},{"lat":-32.92984,"lng":-68.86232,"delito":"Robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-23T01:30:00.000Z"},{"lat":-32.92984,"lng":-68.86232,"delito":"Robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-24T01:30:00.000Z"},{"lat":-32.94858,"lng":-68.86103,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-26T01:30:00.000Z"},{"lat":-32.94069,"lng":-68.85126,"delito":"Pers. en los techos","jurisdiccion":"Comisaria 40","fecha":"2025-06-27T05:30:00.000Z"},{"lat":-32.93459,"lng":-68.86997,"delito":"Intento de robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-28T01:30:00.000Z"},{"lat":-32.92516,"lng":-68.85931,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 40","fecha":"2025-06-29T05:30:00.000Z"},{"lat":-32.94421,"lng":-68.85975,"delito":"Intento de robo","jurisdiccion":"Comisaria 40","fecha":"2025-06-30T09:30:00.000Z"},{"lat":-32.90439,"lng":-68.88657,"delito":"Intento de Robo de iluminaria Dom√®stica","jurisdiccion":"Comisaria 50","fecha":"2025-06-01T09:30:00.000Z"},{"lat":-32.9215,"lng":-68.87571,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-02T03:00:00.000Z"},{"lat":-32.92202,"lng":-68.87744,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-03T01:30:00.000Z"},{"lat":-32.90324,"lng":-68.88303,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-04T05:30:00.000Z"},{"lat":-32.91462,"lng":-68.87821,"delito":"Robo medidor de gas","jurisdiccion":"Comisaria 50","fecha":"2025-06-05T01:30:00.000Z"},{"lat":-32.90617,"lng":-68.88312,"delito":"Int. de Robo y Vandalismo","jurisdiccion":"Comisaria 50","fecha":"2025-06-06T05:30:00.000Z"},{"lat":-32.92152,"lng":-68.87568,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-11T01:30:00.000Z"},{"lat":-32.91641,"lng":-68.87323,"delito":"Intento de robo comercio","jurisdiccion":"Comisaria 50","fecha":"2025-06-13T09:30:00.000Z"},{"lat":-32.92038,"lng":-68.8694,"delito":"Ri√±a entre bandas","jurisdiccion":"Comisaria 50","fecha":"2025-06-16T01:30:00.000Z"},{"lat":-32.90447,"lng":-68.8889,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-17T21:30:00.000Z"},{"lat":-32.946,"lng":-68.82474,"delito":"Tiroteo","jurisdiccion":"Comisaria 50","fecha":"2025-06-19T01:30:00.000Z"},{"lat":-32.90062,"lng":-68.88348,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-20T21:30:00.000Z"},{"lat":-32.90418,"lng":-68.8842,"delito":"Violencia intrafamiliar","jurisdiccion":"Comisaria 50","fecha":"2025-06-21T21:30:00.000Z"},{"lat":-32.91863,"lng":-68.8782,"delito":"Vandalismo","jurisdiccion":"Comisaria 50","fecha":"2025-06-22T05:30:00.000Z"},{"lat":-32.91863,"lng":-68.8782,"delito":"Vandalismo","jurisdiccion":"Comisaria 50","fecha":"2025-06-23T05:30:00.000Z"},{"lat":-32.91433,"lng":-68.87518,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-24T05:30:00.000Z"},{"lat":-32.93132,"lng":-68.89255,"delito":"Vandalismo","jurisdiccion":"Comisaria 50","fecha":"2025-06-25T01:30:00.000Z"},{"lat":-32.90285,"lng":-68.88052,"delito":"Intento de robo","jurisdiccion":"Comisaria 50","fecha":"2025-06-27T01:30:00.000Z"},{"lat":-32.9009,"lng":-68.88354,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-27T17:30:00.000Z"},{"lat":-32.90243,"lng":-68.88506,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 50","fecha":"2025-06-30T21:30:00.000Z"},{"lat":-32.95314,"lng":-68.84344,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 52","fecha":"2025-06-14T21:30:00.000Z"},{"lat":-32.94885,"lng":-68.82498,"delito":"Disturbios/V√≠a p√∫blica","jurisdiccion":"Comisaria 52","fecha":"2025-06-16T05:30:00.000Z"},{"lat":-32.94513,"lng":-68.82562,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 52","fecha":"2025-06-20T01:30:00.000Z"},{"lat":-32.90415,"lng":-68.85027,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-01T13:30:00.000Z"},{"lat":-32.94463,"lng":-68.8466,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-03T05:30:00.000Z"},{"lat":-32.93966,"lng":-68.84391,"delito":"Vandalismo","jurisdiccion":"Comisaria 7","fecha":"2025-06-04T01:30:00.000Z"},{"lat":-32.95018,"lng":-68.85506,"delito":"Intento de Robo","jurisdiccion":"Comisaria 7","fecha":"2025-06-04T01:30:00.000Z"},{"lat":-32.94984,"lng":-68.85493,"delito":"Intento de Robo","jurisdiccion":"Comisaria 7","fecha":"2025-06-04T01:30:00.000Z"},{"lat":-32.92326,"lng":-68.85447,"delito":"Robo de Bicicleta","jurisdiccion":"Comisaria 7","fecha":"2025-06-04T05:30:00.000Z"},{"lat":-32.93928,"lng":-68.84496,"delito":"Intento de Robo","jurisdiccion":"Comisaria 7","fecha":"2025-06-05T05:30:00.000Z"},{"lat":-32.94619,"lng":-68.84576,"delito":"Intento de Robo","jurisdiccion":"Comisaria 7","fecha":"2025-06-06T05:30:00.000Z"},{"lat":-32.94511,"lng":-68.84746,"delito":"Pers/situacion de calle","jurisdiccion":"Comisaria 7","fecha":"2025-06-06T13:30:00.000Z"},{"lat":-32.92509,"lng":-68.8452,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-07T05:30:00.000Z"},{"lat":-32.93656,"lng":-68.84313,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-09T05:30:00.000Z"},{"lat":-32.93643,"lng":-68.84408,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-09T05:30:00.000Z"},{"lat":-32.94752,"lng":-68.82502,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-09T05:30:00.000Z"},{"lat":-32.93723,"lng":-68.85775,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-09T17:30:00.000Z"},{"lat":-32.92435,"lng":-68.84105,"delito":"Intento de robo auto","jurisdiccion":"Comisaria 7","fecha":"2025-06-09T21:30:00.000Z"},{"lat":-32.93477,"lng":-68.84848,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-10T05:30:00.000Z"},{"lat":-32.93997,"lng":-68.85489,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-10T09:30:00.000Z"},{"lat":-32.90851,"lng":-68.84191,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-12T17:30:00.000Z"},{"lat":-32.91204,"lng":-68.84607,"delito":"Narcomenudeo","jurisdiccion":"Comisaria 7","fecha":"2025-06-13T17:30:00.000Z"},{"lat":-32.9423,"lng":-68.84307,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-16T01:30:00.000Z"},{"lat":-32.94587,"lng":-68.84483,"delito":"Intento de robo medidor","jurisdiccion":"Comisaria 7","fecha":"2025-06-16T05:30:00.000Z"},{"lat":-32.93539,"lng":-68.84028,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-19T21:30:00.000Z"},{"lat":-32.94511,"lng":-68.84746,"delito":"Vandalismo","jurisdiccion":"Comisaria 7","fecha":"2025-06-21T05:30:00.000Z"},{"lat":-32.92818,"lng":-68.85781,"delito":"Situacion Sospechosa","jurisdiccion":"Comisaria 7","fecha":"2025-06-26T09:30:00.000Z"},{"lat":-32.94069,"lng":-68.85126,"delito":"Pers. en los techos","jurisdiccion":"Comisaria 7","fecha":"2025-06-30T01:30:00.000Z"},{"lat":-32.95567,"lng":-68.84195,"delito":"Situacion Sospechosa","jurisdiccion":"Sub Comisaria Benegas","fecha":"2025-06-05T01:30:00.000Z"},{"lat":-32.94107,"lng":-68.83497,"delito":"Situacion Sospechosa","jurisdiccion":"Subc Benegas","fecha":"2025-06-28T01:30:00.000Z"},{"lat":-32.94107,"lng":-68.83497,"delito":"Situacion Sospechosa","jurisdiccion":"Subc Benegas","fecha":"2025-06-28T01:30:00.000Z"},{"lat":-32.92922,"lng":-68.82539,"delito":"Situacion Sospechosa","jurisdiccion":"ZIM","fecha":"2025-07-01T01:30:00.000Z"}];
  SAT.PERIOD  = {"desdeISO":"2025-06-01","hastaISO":"2025-06-30","desdeLbl":"01/06/2025","hastaLbl":"30/06/2025","eventos":115};
  if (typeof window.DATA === 'undefined')        window.DATA = SAT.DATA;
  if (typeof window.DELITOS_DATA === 'undefined')window.DELITOS_DATA = SAT.DELITOS;
  if (typeof window.PERIOD === 'undefined')      window.PERIOD = SAT.PERIOD;

  // ===== estado UI/Tabla =====
  let LAST_ROWS = [];
  let delitosDaysLimit = null;
  let filteredDelitosDays = Array.isArray(DELITOS_DATA) ? DELITOS_DATA.slice() : [];

  let POINT_RADIUS = 4;
  let HEAT_RADIUS  = 28;

  function setBtnState(id, active){
    const el = document.getElementById(id);
    if (!el) return;
    var outline = null;
    var classes = el.classList ? Array.from(el.classList) : [];
    for (var i=0;i<classes.length;i++){ if (classes[i].indexOf('btn-outline-')===0){ outline = classes[i]; break; } }
    if (!outline) return;
    const solid = outline.replace('btn-outline-','btn-');
    if (active){ el.classList.remove(outline); el.classList.add(solid); }
    else { el.classList.remove(solid); el.classList.add(outline); }
  }

  function fmtFecha(iso){
    if (!iso) return '';
    try {
      var d = new Date(iso);
      return d.toLocaleDateString('es-AR') + ' ' + d.toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});
    } catch(e){ return ''; }
  }
  function openURL(u){ window.open(u, "_blank"); }
  function isValidDate(d){ return d && !isNaN(+new Date(d)); }

  // ===== filtros din√°micos =====
  const fComis   = document.getElementById('fComis');
  const fDesdeEl = document.getElementById('fDesde');
  const fHastaEl = document.getElementById('fHasta');
  const fVentEl  = document.getElementById('fVentana');

  const uniq = (arr) => Array.from(new Set(arr)).filter(function(x){return !!x;}).sort();
  uniq(DATA.map(function(r){ return r.Distrito; })).forEach(function(v){ fComis.innerHTML += '<option>'+v+'</option>'; });

  if (PERIOD.desdeISO) fDesdeEl.value = PERIOD.desdeISO;
  if (PERIOD.hastaISO) fHastaEl.value = PERIOD.hastaISO;

  fDesdeEl.addEventListener('change', renderAll);
  fHastaEl.addEventListener('change', renderAll);
  fComis.addEventListener('change', renderAll);
  document.getElementById('fFranja').addEventListener('change', renderAll);
  document.getElementById('fDia').addEventListener('change', renderAll);

  fVentEl.addEventListener('change', function(){
    var v = fVentEl.value;
    delitosDaysLimit = v ? parseInt(v, 10) : null;
    renderAll();
  });

  const sPt = document.getElementById('sPt');
  const sPtVal = document.getElementById('sPtVal');
  if (sPt) {
    sPt.addEventListener('input', function(){
      POINT_RADIUS = parseInt(sPt.value,10) || 4;
      HEAT_RADIUS  = Math.max(12, Math.round(POINT_RADIUS * 7));
      if (sPtVal) sPtVal.textContent = POINT_RADIUS;

      if (delitosLayer && map.hasLayer(delitosLayer)) {
        map.removeLayer(delitosLayer);
        delitosLayer = makeDelitosLayer(filteredDelitosDays).addTo(map);
        setBtnState('btnDelitos', true);
      } else {
        delitosLayer = makeDelitosLayer(filteredDelitosDays);
      }
      if (heatLayer && map.hasLayer(heatLayer)) {
        map.removeLayer(heatLayer);
        heatLayer = L.heatLayer(buildHeatDataDelitos(filteredDelitosDays), {radius:HEAT_RADIUS, blur:15, maxZoom:18}).addTo(map);
        setBtnState('btnHeat', true);
      }
    });
  }

  function dayCanonical(s){
    var t = String(s||'')
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .toLowerCase()
      .replace(/[+%()]/g,' ')
      .replace(/\d+/g,' ')
      .replace(/\s+/g,' ')
      .trim();
    if (t.indexOf('lun')>-1) return 'lunes';
    if (t.indexOf('mar')>-1) return 'martes';
    if (t.indexOf('mie')>-1) return 'miercoles';
    if (t.indexOf('jue')>-1) return 'jueves';
    if (t.indexOf('vie')>-1) return 'viernes';
    if (t.indexOf('sab')>-1) return 'sabado';
    if (t.indexOf('dom')>-1) return 'domingo';
    return '';
  }

  function filterRows() {
    var dDesde = fDesdeEl.value;
    var dHasta = fHastaEl.value;
    var distritoSel  = fComis.value || '';
    var diaSel = document.getElementById('fDia').value || '';
    var franja = (document.getElementById('fFranja').value || '');

    var norm = function(s){ return String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase(); };
    var canonical = function(s){
      var t = norm(s);
      if (t.indexOf('madrug')>-1) return 'madrugada';
      if (t.indexOf('manana')>-1 || t.indexOf('ma√±ana')>-1) return 'ma√±ana';
      if (t.indexOf('tarde')>-1)  return 'tarde';
      if (t.indexOf('noche')>-1)  return 'noche';
      return '';
    };

    return DATA.filter(function(r){
      if (dDesde) { if (!r.Fecha || new Date(r.Fecha) < new Date(dDesde + 'T00:00:00')) return false; }
      if (dHasta) { if (!r.Fecha || new Date(r.Fecha) > new Date(dHasta + 'T23:59:59')) return false; }
      if (distritoSel && r.Distrito !== distritoSel) return false;

      if (franja) {
        var can = canonical(r.Franja || '');
        if (!can || canonical(franja) !== can) return false;
      }

      if (diaSel) {
        var dRow = dayCanonical(r.D√≠a || r.Dia || '');
        if (!dRow || dRow !== dayCanonical(diaSel)) return false;
      }

      return true;
    });
  }

  // ===== Delitos de Estudio (ahora textos ‚ÄúEventos‚Äù) =====
  function currentDateRange(){
    var ds = fDesdeEl.value;
    var hs = fHastaEl.value;
    var d1 = ds ? new Date(ds + 'T00:00:00') : null;
    var d2 = hs ? new Date(hs + 'T23:59:59') : null;
    return [d1, d2];
  }

  function getFilteredDelitos(){
    if (!Array.isArray(DELITOS_DATA)) return [];
    var dr = currentDateRange();
    var d1 = dr[0], d2 = dr[1];
    var now = new Date();
    return DELITOS_DATA.filter(function(p){
      if (!p || !isFinite(p.lat) || !isFinite(p.lng)) return false;
      if (!p.fecha || !isValidDate(p.fecha)) return true;
      var f = new Date(p.fecha);
      if (d1 && f < d1) return false;
      if (d2 && f > d2) return false;
      if (delitosDaysLimit != null) {
        var diff = (now - f) / (1000*60*60*24);
        if (diff > delitosDaysLimit) return false;
      }
      return true;
    });
  }

  // ===== mapa =====
  var map, baseOSM, sat, roads, heatLayer, centroidLayer, polygonLayer, eventsLayer, circleLayer, delitosLayer;
  var filterChipCtrl = null, filterChipEl = null;

  initMap();

  function initMap(){
    map = L.map('map').setView([-32.889, -68.845], 12);
    baseOSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    map.createPane('pane-polys');     map.getPane('pane-polys').style.zIndex = 200; map.getPane('pane-polys').style.pointerEvents = 'none';
    map.createPane('pane-circles');   map.getPane('pane-circles').style.zIndex = 210;
    map.createPane('pane-events');    map.getPane('pane-events').style.zIndex = 220;
    map.createPane('pane-delitos');   map.getPane('pane-delitos').style.zIndex = 230;
    map.createPane('pane-centroids'); map.getPane('pane-centroids').style.zIndex = 300;

    sat   = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3']});
    roads = L.tileLayer('https://{s}.google.com/vt/lyrs=h&x={x}&y={y}&z={z}', {maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3']});

    document.getElementById('btnBase').onclick = function(){
      map.addLayer(baseOSM); map.removeLayer(sat); map.removeLayer(roads);
      setBtnState('btnBase', true); setBtnState('btnHybrid', false);
    };
    document.getElementById('btnHybrid').onclick = function(){
      map.removeLayer(baseOSM); sat.addTo(map); roads.addTo(map);
      setBtnState('btnBase', false); setBtnState('btnHybrid', true);
    };

    document.getElementById('btnHeat').onclick = function(){
      if (heatLayer) {
        map.removeLayer(heatLayer); heatLayer=null; setBtnState('btnHeat', false);
      } else {
        heatLayer = L.heatLayer(buildHeatDataDelitos(filteredDelitosDays), {radius:HEAT_RADIUS, blur:15, maxZoom:18}).addTo(map);
        setBtnState('btnHeat', true);
      }
    };
    document.getElementById('btnPolys').onclick = function(){
      if (!polygonLayer) return;
      if (map.hasLayer(polygonLayer)) { map.removeLayer(polygonLayer); setBtnState('btnPolys', false); }
      else { polygonLayer.addTo(map); setBtnState('btnPolys', true); }
    };
    document.getElementById('btnCircles').onclick = function(){
      if (!circleLayer) return;
      if (map.hasLayer(circleLayer)) { map.removeLayer(circleLayer); setBtnState('btnCircles', false); }
      else { circleLayer.addTo(map); setBtnState('btnCircles', true); }
    };
    document.getElementById('btnDelitos').onclick = function(){
      if (!delitosLayer) delitosLayer = makeDelitosLayer(filteredDelitosDays);
      if (map.hasLayer(delitosLayer)) { map.removeLayer(delitosLayer); setBtnState('btnDelitos', false); }
      else { delitosLayer.addTo(map); setBtnState('btnDelitos', true); }
    };

    filterChipCtrl = L.control({position:'topright'});
    filterChipCtrl.onAdd = function(){
      filterChipEl = L.DomUtil.create('div', 'filter-chip leaflet-control');
      filterChipEl.style.display = 'none';
      filterChipEl.innerHTML = '';
      return filterChipEl;
    };
    filterChipCtrl.addTo(map);

    renderMap(filterRows());

    setBtnState('btnBase', true);
    setBtnState('btnHybrid', false);
    setBtnState('btnPolys', true);
    setBtnState('btnCircles', true);
    setBtnState('btnDelitos', false);
    setBtnState('btnHeat', false);
  }

  function buildHeatDataDelitos(arr){
    return (arr||[]).filter(function(p){ return isFinite(p.lat) && isFinite(p.lng); }).map(function(p){ return [p.lat, p.lng, 1]; });
  }

  function makeDelitosLayer(arr){
    const g = L.layerGroup();
    (arr||[]).forEach(function(p){
      if (!isFinite(p.lat) || !isFinite(p.lng)) return;
      const t = '<b>' + (p.jurisdiccion||'') + '</b> ‚Äî ' + ((p.evento||p.delito)||'') + (p.fecha? ('<br><i>'+fmtFecha(p.fecha)+'</i>') : '');
      L.circleMarker([p.lat, p.lng], {
        radius:POINT_RADIUS, color:'#c0392b', weight:1, fillColor:'#e74c3c', fillOpacity:.8,
        pane:'pane-delitos'
      })
      .bindTooltip(t, {direction:'top', offset:[0,-6]})
      .addTo(g);
    });
    return g;
  }

  function renderMap(arr){
    if (centroidLayer) { map.removeLayer(centroidLayer); }
    if (polygonLayer)  { map.removeLayer(polygonLayer); }
    if (eventsLayer)   { map.removeLayer(eventsLayer); }
    if (circleLayer)   { map.removeLayer(circleLayer); }
    if (delitosLayer)  { map.removeLayer(delitosLayer); }
    if (heatLayer)     { map.removeLayer(heatLayer); heatLayer=null; }

    centroidLayer = L.layerGroup().addTo(map);
    polygonLayer  = L.layerGroup().addTo(map);
    eventsLayer   = L.layerGroup().addTo(map);
    circleLayer   = L.layerGroup().addTo(map);
    delitosLayer  = makeDelitosLayer(filteredDelitosDays);

    const bounds = [];

    arr.forEach(function(r){
      if (r.Poligono_WKT) {
        try {
          const gj = wellknown.parse(r.Poligono_WKT);
          const poly = L.geoJSON(gj, {style:{color:'#0d6efd', weight:2, fillOpacity:.05}, interactive:false, pane:'pane-polys'}).addTo(polygonLayer);
          try { bounds.push(poly.getBounds()); } catch(e){}
        } catch(e){}
      }

      if (isFinite(r.Centroide_lat) && isFinite(r.Centroide_lng)) {
        L.circleMarker([r.Centroide_lat, r.Centroide_lng], {
          radius:6, color:'#0d6efd', weight:2, fillColor:'#0d6efd', fillOpacity:.7, pane:'pane-centroids'
        })
        .bindTooltip(buildTooltip(r), {direction:'top', offset:[0,-6]})
        .addTo(centroidLayer);
        bounds.push(L.latLngBounds([ [r.Centroide_lat, r.Centroide_lng], [r.Centroide_lat, r.Centroide_lng] ]));

        const rad = (Number(r.Radio_m)||0) > 0 ? Number(r.Radio_m) : 450;
        L.circle([r.Centroide_lat, r.Centroide_lng], {radius: rad, color:'#0d6efd', weight:1, fillOpacity:0.03, interactive:false, pane:'pane-circles'}).addTo(circleLayer);
      }

      if (r.Eventos_puntos) {
        const pts = String(r.Eventos_puntos).split(/[|;]+/).map(function(s){ return s.trim(); }).filter(Boolean);
        pts.forEach(function(pt){
          const nums = pt.match(/-?\d+(?:\.\d+)?/g);
          if (!nums || nums.length<2) return;
          const la = Number(nums[0]), ln = Number(nums[1]);
          if (isFinite(la) && isFinite(ln)) {
            L.circleMarker([la,ln], {radius:3, color:'#c0392b', weight:1, fillColor:'#e74c3c', fillOpacity:.6, pane:'pane-events'}).addTo(eventsLayer);
          }
        });
      }
    });

    if (bounds.length) {
      const all = bounds.reduce(function(acc,b){ return acc ? acc.extend(b) : b; }, null);
      if (all) map.fitBounds(all.pad(0.15));
      setBtnState('btnPolys', true);
      setBtnState('btnCircles', true);
      setBtnState('btnDelitos', false);
      setBtnState('btnHeat', !!(heatLayer && map.hasLayer(heatLayer)));
    }
  }

  /* === REEMPLAZO: Tooltip + Tabla (ASCII seguro) === */
  function buildTooltip(r){
    var zona   = r.Zona_centroide || '';
    var calles = r.Calles_triangulacion || '';
    var chip   = [r.Distrito, r.Comisaria].filter(function(x){return !!x;}).join(' / ');
    var rangoOp= r.Rango_operativo_SAT || r.Rango_horario_total || '';
    var confL  = r.Confiabilidad_leyenda ? ('<br><b>Confiabilidad:</b> ' + r.Confiabilidad_leyenda) : '';
    var linkPat= r.Link_Patrullaje_URL ? ('<br><b>Patrullaje:</b> <a href="' + r.Link_Patrullaje_URL + '" target="_blank">Ver</a>') : '';
    return '<div><b>' + chip + '</b><br>'
         + '<b>Zona:</b> ' + zona + '<br>'
         + '<b>Poligono:</b> ' + calles + '<br>'
         + '<b>Horario operativo:</b> ' + rangoOp + '<br>'
         + '<b>Radio:</b> ' + (r.Radio_m || '') + ' m - <b>Eventos:</b> ' + (r.Cantidad_eventos || 0)
         + confL + linkPat + '</div>';
  }

  var TB = document.getElementById('tbody');

  function renderTable(arr){
    TB.innerHTML = '';
    arr.forEach(function(r, idx){
      var link    = r.Link_GMaps_URL ? '<a href="' + r.Link_GMaps_URL + '" target="_blank">Mapa</a>' : '';
      var linkPat = r.Link_Patrullaje_URL ? '<a href="' + r.Link_Patrullaje_URL + '" target="_blank">Patrullaje</a>' : '';
      var btnWA   = '<button class="btn btn-sm btn-whatsapp" onclick="shareWA(' + idx + ')">WhatsApp</button>';
      var btnPDF  = '<button class="btn btn-sm btn-outline-dark" onclick="makePDF(' + idx + ')">PDF</button>';
      var rangoOp = r.Rango_operativo_SAT || r.Rango_horario_total || '';

      TB.innerHTML += ''
        + '<tr>'
        +   '<td>' + (r.Distrito || '') + '</td>'
        +   '<td>' + (r.Comisaria || '') + '</td>'
        +   '<td>' + (r.Zona_centroide || '') + '</td>'
        +   '<td>' + (r.Franja || '') + '</td>'
        +   '<td>' + (rangoOp || '') + '</td>'
        +   '<td>' + (r.Radio_m || '') + '</td>'
        +   '<td>' + (r.Cantidad_eventos || 0) + '</td>'
        +   '<td class="d-flex gap-1 flex-wrap">' + link + ' ' + linkPat + ' ' + btnWA + ' ' + btnPDF + '</td>'
        + '</tr>';
    });
  }

  function updateFilterChip(){
    if (!filterChipEl) return;

    const parts = [];
    const elDia    = document.getElementById('fDia');     const diaSel    = (elDia && elDia.value) || '';
    const elFran   = document.getElementById('fFranja');  const franjaSel = (elFran && elFran.value) || '';
    const elComis  = document.getElementById('fComis');   const comisSel  = (elComis && elComis.value) || '';
    const elVent   = document.getElementById('fVentana'); const ventVal   = (elVent && elVent.value) || '';
    const elDesde  = document.getElementById('fDesde');   const ds        = (elDesde && elDesde.value) || '';
    const elHasta  = document.getElementById('fHasta');   const hs        = (elHasta && elHasta.value) || '';

    if (diaSel)    parts.push(diaSel);
    if (franjaSel) parts.push(franjaSel);
    if (comisSel)  parts.push('Distrito: ' + comisSel);
    if (ds || hs) {
      const fmt = function(s){ try { return new Date(s).toLocaleDateString('es-AR'); } catch(e){ return s; } };
      const rango = (ds? fmt(ds):'') + ((ds||hs)? ' ‚Äì ' : '') + (hs? fmt(hs):'');
      parts.push(rango.trim());
    }
    if (ventVal) {
      const labelmap = { '1':'24 hs', '2':'48 hs', '3':'72 hs', '7':'7 d√≠as', '15':'15 d√≠as' };
      parts.push('Eventos: ' + (labelmap[ventVal] || (ventVal + ' d√≠as')));
    }

    if (parts.length){
      filterChipEl.innerHTML = '<b>Filtro:</b> ' + parts.join(' ‚Ä¢ ');
      filterChipEl.style.display = '';
    } else {
      filterChipEl.style.display = 'none';
      filterChipEl.innerHTML = '';
    }
  }

  function renderAll(){
    const arr = filterRows();
    LAST_ROWS = arr.slice();

    filteredDelitosDays = getFilteredDelitos();

    renderMap(arr);
    const kA = arr.length;
    const kE = arr.reduce(function(a,r){ return a + (Number(r.Cantidad_eventos)||0); }, 0);
    document.getElementById('kpiAlertas').textContent = kA;
    document.getElementById('kpiEventos').textContent = kE;
    renderTable(arr);

    const elDia = document.getElementById('fDia');
    const diaSel = (elDia && elDia.value) || '';
    const kpiDia = document.getElementById('kpiDia');
    const kpiDiaVal = document.getElementById('kpiDiaVal');
    if (kpiDia && kpiDiaVal) {
      if (diaSel) { kpiDiaVal.textContent = diaSel; kpiDia.classList.remove('d-none'); }
      else { kpiDia.classList.add('d-none'); kpiDiaVal.textContent = ''; }
    }

    updateFilterChip();
  }

  // =======================
  // WhatsApp ‚Äì Formato + Ruta sugerida
  // =======================
  function waEmoji(name){
    if (name === 'shield') return 'üõ°Ô∏è ';
    if (name === 'pin')    return 'üìç ';
    if (name === 'road')   return 'üõ£Ô∏è ';
    return '';
  }

  // Ruta sugerida (RegExp constructor: seguro dentro de template literal)
  function buildRutaSugerida(pol){
    var s = String(pol||'').trim();
    if (!s) return 's/d';
    // \s -> s ; \/ -> / ; \\| -> |
    var sep = new RegExp("\\s*(?:\/|->|‚Üí|\\|;)\\s*");
    var pts = s.split(sep).filter(function(x){ return !!x; });
    if (!pts.length) return 's/d';
    if (pts.length === 1) return 'Punto fijo: ' + pts[0];
    return pts.join(' -> ') + ' -> ' + pts[0] + ' (circuito)';
  }

  // Sanitizador ASCII para WhatsApp
  function sanitizeASCII(s){
    s = String(s||'');
    s = s.replace(/[ÔøΩ-ÔøΩ][ÔøΩ-ÔøΩ]/g,''); // emojis tipo surrogate
    s = s.replace(/[Ô∏è‚Äç]/g,'');                 // variation selector / ZWJ
    s = s.replace(/¬†/g,' ').replace(/[‚Äì‚Äî]/g,'-');   // NBSP y guiones largos
    return s.trim();
  }

  function bestLink(r){
    return r.Link_GMaps_URL || r.Link_Patrullaje_URL || 's/d';
  }

  // WhatsApp por fila
  window.shareWA = function(idx){
    var r = LAST_ROWS[idx];
    if (!r) return;

    var chip    = sanitizeASCII([r.Distrito, r.Comisaria].filter(Boolean).join(' / ') || 's/d');
    var dia     = sanitizeASCII(r.D√≠a || r.Dia || 's/d');
    var franja  = sanitizeASCII(r.Franja || 's/d');
    var rangoOp = sanitizeASCII(r.Rango_operativo_SAT || r.Rango_horario_total || 's/d');
    var confTxt = sanitizeASCII(r.Confiabilidad_leyenda || 's/d');
    var zona    = sanitizeASCII(r.Zona_centroide || 's/d');
    var radio   = sanitizeASCII(String(r.Radio_m || 0)) + ' m';
    var ruta    = sanitizeASCII(buildRutaSugerida(r.Calles_triangulacion || ''));
    var link    = sanitizeASCII(bestLink(r));

    var lines = [
      'üõ°Ô∏è PATRULLAJE SAT - ' + (chip || 's/d') + '',
      '_____________',
      'Orden de Policiamiento:',
      'D√≠a: ' + dia + '  ¬∑  Franja: ' + franja,
      'Rango operativo: ' + rangoOp + ' - Confiabilidad: ' + confTxt,
      'üìç Zona: ' + zona + ' - Radio: ' + radio,
      'üõ£Ô∏è Ruta sugerida: ' + ruta,
      'Instrucciones: Patrullar cada 20 min con detenci√≥n breve y balizas encendidas.',
      'Clic Ver Patrullaje Sugerido: ' + link,
      'Observaciones: Velocidad sugerida 20 km/h. Reportar novedades en SAT y a su superior.'
    ];

    var msg = lines.join('\n');
    window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
  };

  // ===== PDF por fila =====
  window.makePDF = async function(idx){
    const r = LAST_ROWS[idx];
    if (!r) return;
    const rangoOp = r.Rango_operativo_SAT || r.Rango_horario_total || '';
    const confL = r.Confiabilidad_leyenda ? ('<div><b>Confiabilidad:</b> '+r.Confiabilidad_leyenda+'</div>') : '';
    const box = document.createElement('div');
    box.style.position='fixed'; box.style.top='-9999px'; box.style.left='-9999px';
    box.style.width='600px'; box.style.padding='16px'; box.style.background='#fff'; box.style.border='1px solid #ddd';
    box.innerHTML = `
      <h5>SAT ‚Äì Sistema de An√°lisis Territorial</h5>
      <div><b>Distrito/Comisar√≠a:</b> ${[r.Distrito,r.Comisaria].filter(Boolean).join(' / ')}</div>
      <div><b>Zona:</b> ${r.Zona_centroide}</div>
      <div><b>Pol√≠gono:</b> ${r.Calles_triangulacion}</div>
      <div><b>Horario operativo:</b> ${rangoOp}</div>
      <div><b>Radio (m):</b> ${r.Radio_m || ''} ¬∑ <b>Eventos:</b> ${r.Cantidad_eventos || 0}</div>
      <div><b>Mapa:</b> ${r.Link_GMaps_URL ? r.Link_GMaps_URL : (r.Link_Patrullaje_URL ? r.Link_Patrullaje_URL : '(s/d)')} </div>
      ${confL}
      <br>
      <div>üìù <b>Directiva:</b><br>Patrullar cada 20 min con detenci√≥n breve y balizas encendidas.</div>
      <div>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
      <div>‚ö†Ô∏è Recuerda patrullar a 20 km/h y reportar novedades en SAT y a tu Superior</div>
      <br><div class="small">¬© SAT ‚Äì Oficina de Estad√≠sticas y An√°lisis Delictual y Operacional</div>
    `;
    document.body.appendChild(box);
    const canvas = await html2canvas(box);
    document.body.removeChild(box);
    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p','pt','a4');
    const pageW = pdf.internal.pageSize.getWidth();
    const ratio = (pageW - 40) / canvas.width;
    pdf.addImage(imgData, 'PNG', 20, 20, canvas.width*ratio, canvas.height*ratio);
    pdf.save('SAT_Patrullaje_'+(r.Distrito||'')+'_'+(r.Zona_centroide||'')+'.pdf');
  };

  // Render inicial
  renderAll();
  </script>

</body>
</html>
